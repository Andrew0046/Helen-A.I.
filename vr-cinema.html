<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Cinema for VR: Immersive Theater</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
        /* 2D UI Overlay 
           This sits "on top" of the 3D scene so you can load files 
           before putting the phone in the Cardboard viewer.
        */
        #ui-layer {
            position: absolute;
            z-index: 9999;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            transition: opacity 0.5s;
        }
        
        .hidden { opacity: 0; pointer-events: none; }

        #drop-zone {
            width: 80%;
            max-width: 500px;
            padding: 40px;
            border: 3px dashed #e50914;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.05);
            transition: background 0.3s;
        }

        #drop-zone.hover { background: rgba(229, 9, 20, 0.2); }

        .btn {
            padding: 12px 24px;
            background: #e50914;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .controls-hint {
            margin-top: 30px;
            font-size: 0.9rem;
            color: #aaa;
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <h1>Cinema VR Loader</h1>
        <div id="drop-zone">
            <p>Drag & Drop Video File Here</p>
            <p><i>(mp4, webm)</i></p>
            <input type="file" id="file-input" accept="video/*" style="display:none">
            <button class="btn" onclick="document.getElementById('file-input').click()">Browse Files</button>
        </div>
        <div class="controls-hint">
            <p><b>IN VR:</b> Gaze at buttons for 2 seconds to click.</p>
            <p>Look down to see playback controls.</p>
        </div>
    </div>

    <a-scene background="color: #050505" fog="type: exponential; color: #050505; density: 0.02">
        
        <a-assets>
            <video id="video-src" src="" playsinline webkit-playsinline loop="false"></video>
            <img id="floor-texture" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
        </a-assets>

        <a-plane position="0 0 -4" rotation="-90 0 0" width="50" height="50" 
                 src="#floor-texture" repeat="10 10" 
                 color="#222" roughness="0.4" metalness="0.5">
        </a-plane>

        <a-entity sound="src: url(https://cdn.aframe.io/basic-guide/audio/backgroundnoise.wav); autoplay: true; loop: true; volume: 0.3"></a-entity>

        <a-light type="ambient" color="#222"></a-light>
        <a-light type="point" position="0 5 0" intensity="0.3" color="#444"></a-light>


        <a-curvedimage id="screen-cinema" 
            src="#video-src"
            height="12" 
            radius="14" 
            theta-length="80" 
            rotation="0 140 0" 
            position="0 5 0"
            side="double"
            visible="true">
        </a-curvedimage>

        <a-videosphere id="screen-360" 
            src="#video-src" 
            rotation="0 -90 0" 
            visible="false">
        </a-videosphere>


        <a-entity id="control-panel" position="0 1.2 -2.5" rotation="-25 0 0">
            <a-box depth="0.1" height="0.8" width="3.2" color="#111" opacity="0.9"></a-box>

            <a-plane id="btn-play" position="-0.8 0 0.06" width="0.6" height="0.4" color="#333" class="clickable">
                <a-text value="PLAY" align="center" width="3" position="0 0 0.01"></a-text>
            </a-plane>

            <a-plane id="btn-mode" position="0 0 0.06" width="0.6" height="0.4" color="#333" class="clickable">
                <a-text value="2D / 360" align="center" width="3" position="0 0 0.01"></a-text>
            </a-plane>

            <a-plane id="btn-reset" position="0.8 0 0.06" width="0.6" height="0.4" color="#333" class="clickable">
                <a-text value="RESET" align="center" width="3" position="0 0 0.01"></a-text>
            </a-plane>

            <a-box position="0 -0.5 0" width="3" height="0.05" depth="0.05" color="#555"></a-box>
            <a-box id="progress-fill" position="-1.5 -0.5 0.01" width="3" height="0.06" depth="0.06" color="#e50914" scale="0 1 1" pivot="center left"></a-box>
        </a-entity>


        <a-entity id="rig" position="0 1.6 0">
            <a-camera look-controls wasd-controls="enabled: false">
                
                <a-cursor 
                    id="cursor"
                    fuse="true" 
                    fuse-timeout="1500"
                    color="#e50914"
                    raycaster="objects: .clickable"
                    scale="1 1 1"
                    animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                    animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500">
                </a-cursor>

                <a-text value="Look down for controls" position="0 -0.6 -1" align="center" width="0.8" color="#888"></a-text>
            </a-camera>
        </a-entity>

    </a-scene>

    <script>
        /* --- JAVASCRIPT LOGIC --- */
        const uiLayer = document.getElementById('ui-layer');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const video = document.getElementById('video-src');
        
        const screenCinema = document.getElementById('screen-cinema');
        const screen360 = document.getElementById('screen-360');
        const progressFill = document.getElementById('progress-fill');
        const btnPlay = document.querySelector('#btn-play a-text'); // Text element inside button

        let is360Mode = false;

        // 1. DRAG & DROP HANDLING
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('hover');
        });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('hover'));
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('hover');
            if (e.dataTransfer.files.length) {
                loadVideo(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) loadVideo(e.target.files[0]);
        });

        function loadVideo(file) {
            const url = URL.createObjectURL(file);
            video.src = url;
            uiLayer.classList.add('hidden'); // Hide the 2D UI
            video.play();
            btnPlay.setAttribute('value', 'PAUSE');
        }

        // 2. VR CONTROLS INTERACTION
        
        // Play/Pause
        document.getElementById('btn-play').addEventListener('click', () => {
            if (video.paused) {
                video.play();
                btnPlay.setAttribute('value', 'PAUSE');
            } else {
                video.pause();
                btnPlay.setAttribute('value', 'PLAY');
            }
        });

        // Toggle Cinema vs 360
        document.getElementById('btn-mode').addEventListener('click', () => {
            is360Mode = !is360Mode;
            if (is360Mode) {
                screenCinema.setAttribute('visible', false);
                screen360.setAttribute('visible', true);
            } else {
                screenCinema.setAttribute('visible', true);
                screen360.setAttribute('visible', false);
            }
        });

        // Reset Rotation (if user drifts)
        document.getElementById('btn-reset').addEventListener('click', () => {
            const cam = document.querySelector('[camera]');
            cam.setAttribute('rotation', '0 0 0');
        });

        // 3. PROGRESS BAR LOGIC
        // We scale the red bar along the X axis from 0 to 1 based on video time
        setInterval(() => {
            if (video.duration) {
                const pct = video.currentTime / video.duration;
                // Position adjustment handles the "pivot" logic visually
                // (Scaling a primitive works from center, so we shift position to make it look like left-to-right fill)
                // Actually, simplest way with A-Frame primitives is just scale, but let's use the simple scale method:
                progressFill.object3D.scale.x = pct;
                
                // Adjust position to make it grow from left (pivot fix)
                // The bar is width 3. center is 0. Left edge is -1.5.
                // Current center = -1.5 + (width * scale / 2)
                progressFill.object3D.position.x = -1.5 + (3 * pct / 2);
            }
        }, 100);

    </script>
</body>
</html>
