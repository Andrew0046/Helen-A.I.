<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR Cinema â€¢ Immersive Theater</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
    #ui {
      position: absolute; top: 10px; left: 10px; z-index: 100;
      background: rgba(0,0,0,0.85); color: white; padding: 20px; border-radius: 12px;
      max-width: 380px; box-shadow: 0 0 20px rgba(0,0,0,0.8);
    }
    #drop-zone {
      border: 3px dashed #fff; padding: 30px; text-align: center; margin: 15px 0;
      border-radius: 8px; cursor: pointer; transition: all 0.3s;
    }
    #drop-zone.dragover { background: rgba(255,255,255,0.1); border-color: #0f0; }
    button, input { margin: 5px; padding: 10px; }
    #playlist li { cursor: pointer; padding: 8px; background: #222; margin: 4px 0; border-radius: 4px; }
    #playlist li:hover { background: #444; }
  </style>
</head>
<body>

<!-- HTML Overlay for loading videos -->
<div id="ui">
  <h1>ðŸŽ¥ VR Cinema</h1>
  <p><strong>Drag & drop videos</strong> or use the button below</p>
  
  <input type="file" id="file-input" multiple accept="video/*">
  
  <div id="drop-zone">Drop video files here</div>
  
  <h3>Playlist</h3>
  <ul id="playlist"></ul>
  
  <button onclick="enterVR()">Enter VR Theater</button>
  <p style="font-size:0.9em; opacity:0.8;">Use gaze (look + fuse) to control playback in VR</p>
</div>

<a-scene background="color: #050505" fog="type: exponential; color: #111111; density: 0.015" 
         antialias="true" loading-screen="dotsColor: #fff; backgroundColor: #000">

  <a-assets>
    <!-- Main video player -->
    <video id="main-video" crossorigin="anonymous" playsinline loop></video>
    
    <!-- Optional ambient theater sound (replace with a real free loop URL) -->
    <!-- <audio id="ambience" src="https://freesound.org/data/previews/..." loop></audio> -->
  </a-assets>

  <!-- Camera Rig (auto-positioned in seat) -->
  <a-entity id="rig" position="0 1.6 8">
    <a-camera id="camera" look-controls wasd-controls="acceleration: 30">
      <!-- Gaze cursor for Cardboard -->
      <a-cursor id="cursor" fuse="true" fuse-timeout="1200" 
                color="#ffffff" opacity="0.8"
                geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.025"
                material="shader: flat">
      </a-cursor>
    </a-camera>
  </a-entity>

  <!-- Floor -->
  <a-plane position="0 0 0" rotation="-90 0 0" width="80" height="80" color="#1a1a1a" roughness="1"></a-plane>

  <!-- Ceiling -->
  <a-plane position="0 18 0" rotation="90 0 0" width="80" height="80" color="#0a0a0a"></a-plane>

  <!-- Back wall -->
  <a-plane position="0 9 -40" width="80" height="18" color="#0a0a0a"></a-plane>

  <!-- Side walls -->
  <a-plane position="-40 9 0" rotation="0 90 0" width="80" height="18" color="#0a0a0a"></a-plane>
  <a-plane position="40 9 0" rotation="0 -90 0" width="80" height="18" color="#0a0a0a"></a-plane>

  <!-- Simple red curtains on sides -->
  <a-plane position="-28 9 -15" rotation="0 80 0" width="12" height="14" color="#4a0000" opacity="0.7"></a-plane>
  <a-plane position="28 9 -15" rotation="0 -80 0" width="12" height="14" color="#4a0000" opacity="0.7"></a-plane>

  <!-- Large Curved Cinematic Screen -->
  <a-entity id="cinema-screen"
    geometry="primitive: cylinder; radius: 28; height: 15; theta-length: 115; openEnded: true"
    position="0 9 -22"
    material="src: #main-video; shader: flat; side: back; color: #ffffff"
    visible="true">
  </a-entity>

  <!-- 360Â° Sphere (hidden by default) -->
  <a-videosphere id="sphere-360" radius="90" material="src: #main-video; shader: flat" visible="false"></a-videosphere>

  <!-- Theater Seats (generated by JS) -->
  <!-- Lights -->
  <a-light type="ambient" color="#222222"></a-light>
  <a-light type="point" position="0 12 -10" intensity="0.4" color="#ffeedd"></a-light>

  <!-- Control Panel (gaze buttons) -->
  <a-entity id="controls" position="0 3.5 -6" rotation="0 0 0">

    <!-- Play / Pause -->
    <a-entity id="btn-play" position="-4 0 0" 
      geometry="primitive: plane; width: 2.2; height: 0.9"
      material="color: #222; opacity: 0.85"
      text="value: â–¶ Play; color: #0f0; align: center; width: 2.5; zOffset: 0.01">
    </a-entity>

    <!-- Progress Bar -->
    <a-entity id="progress-bg" position="0 0 0"
      geometry="primitive: plane; width: 8; height: 0.12"
      material="color: #333; opacity: 0.8"></a-entity>
    <a-entity id="progress-bar" position="-4 0 0.01"
      geometry="primitive: plane; width: 0; height: 0.12"
      material="color: #00ff88"></a-entity>

    <!-- Time -->
    <a-entity id="time-text" position="0 -0.6 0"
      text="value: 00:00 / 00:00; color: #aaa; align: center; width: 6"></a-entity>

    <!-- Next -->
    <a-entity id="btn-next" position="4 0 0"
      geometry="primitive: plane; width: 1.8; height: 0.9"
      material="color: #222; opacity: 0.85"
      text="value: Next â–¶; color: white; align: center; width: 2"></a-entity>

    <!-- 360Â° Toggle -->
    <a-entity id="btn-360" position="0 -1.8 0"
      geometry="primitive: plane; width: 3.2; height: 0.9"
      material="color: #222; opacity: 0.85"
      text="value: 360Â° Mode: OFF; color: #ff0; align: center; width: 3.5"></a-entity>
  </a-entity>

</a-scene>

<script>
// ====================== Variables ======================
let playlist = [];
let currentIndex = -1;
let is360Mode = false;
const video = document.getElementById('main-video');
const scene = document.querySelector('a-scene');
const rig = document.getElementById('rig');
const cinemaScreen = document.getElementById('cinema-screen');
const sphere360 = document.getElementById('sphere-360');

// UI elements
const btnPlay = document.getElementById('btn-play');
const progressBg = document.getElementById('progress-bg');
const progressBar = document.getElementById('progress-bar');
const timeText = document.getElementById('time-text');
const btnNext = document.getElementById('btn-next');
const btn360 = document.getElementById('btn-360');

// ====================== Playlist & File Handling ======================
const playlistEl = document.getElementById('playlist');
const dropZone = document.getElementById('drop-zone');
const fileInput = document.getElementById('file-input');

function addToPlaylist(file) {
  const url = URL.createObjectURL(file);
  playlist.push({ name: file.name, url });
  
  const li = document.createElement('li');
  li.textContent = file.name;
  li.onclick = () => {
    currentIndex = playlist.length - 1;
    loadVideo(currentIndex);
  };
  playlistEl.appendChild(li);
}

fileInput.addEventListener('change', (e) => {
  Array.from(e.target.files).forEach(addToPlaylist);
});

dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.classList.add('dragover');
});
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  Array.from(e.dataTransfer.files).forEach(addToPlaylist);
});

// Load video
function loadVideo(index) {
  if (index < 0 || index >= playlist.length) return;
  currentIndex = index;
  video.src = playlist[index].url;
  video.load();
  video.play().catch(() => {});
}

// ====================== VR Controls ======================
function togglePlay() {
  if (video.paused) video.play();
  else video.pause();
}

function nextVideo() {
  currentIndex = (currentIndex + 1) % playlist.length;
  loadVideo(currentIndex);
}

function prevVideo() {
  currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
  loadVideo(currentIndex);
}

function toggle360() {
  is360Mode = !is360Mode;
  cinemaScreen.setAttribute('visible', !is360Mode);
  sphere360.setAttribute('visible', is360Mode);
  btn360.setAttribute('text', `value: 360Â° Mode: ${is360Mode ? 'ON' : 'OFF'}; color: ${is360Mode ? '#0f0' : '#ff0'}`);
}

// Button listeners
btnPlay.addEventListener('click', togglePlay);
btnNext.addEventListener('click', nextVideo);
btn360.addEventListener('click', toggle360);

// Progress bar & time
function updateProgress() {
  if (!video.duration) return;
  const progress = video.currentTime / video.duration;
  progressBar.setAttribute('geometry', `primitive: plane; width: ${progress * 8}; height: 0.12`);
  progressBar.setAttribute('position', `${-4 + (progress * 4)} 0 0.01`);

  const current = formatTime(video.currentTime);
  const total = formatTime(video.duration);
  timeText.setAttribute('text', `value: ${current} / ${total}`);
}

function formatTime(seconds) {
  const min = Math.floor(seconds / 60);
  const sec = Math.floor(seconds % 60);
  return `${min}:${sec.toString().padStart(2, '0')}`;
}

// Animation loop for progress
function animate() {
  requestAnimationFrame(animate);
  updateProgress();
}
animate();

// ====================== Enter VR & Seat Positioning ======================
function enterVR() {
  if (playlist.length === 0) {
    alert("Add at least one video first!");
    return;
  }
  if (currentIndex === -1) loadVideo(0);
  
  scene.enterVR();
}

// Position user in seat when entering VR
scene.addEventListener('enter-vr', () => {
  rig.setAttribute('position', '0 1.6 8');
  rig.removeAttribute('wasd-controls'); // Fixed seat experience
  document.getElementById('ui').style.opacity = '0.3'; // Dim overlay
});

// Optional: Add some seats (simple boxes)
function createSeats() {
  const seatPositions = [
    // Front row
    [-6, 0.8, -12], [-4, 0.8, -12], [-2, 0.8, -12], [2, 0.8, -12], [4, 0.8, -12], [6, 0.8, -12],
    // Middle rows
    [-8, 0.8, -18], [-5, 0.8, -18], [0, 0.8, -18], [5, 0.8, -18], [8, 0.8, -18],
  ];
  
  seatPositions.forEach(pos => {
    const seat = document.createElement('a-entity');
    seat.setAttribute('position', pos.join(' '));
    
    // Seat base
    const base = document.createElement('a-box');
    base.setAttribute('width', '1.2'); base.setAttribute('height', '0.3'); base.setAttribute('depth', '1.2');
    base.setAttribute('color', '#2a2a2a');
    seat.appendChild(base);
    
    // Seat back
    const back = document.createElement('a-box');
    back.setAttribute('width', '1.2'); back.setAttribute('height', '1.4'); back.setAttribute('depth', '0.2');
    back.setAttribute('position', '0 0.85 -0.5');
    back.setAttribute('color', '#1f1f1f');
    seat.appendChild(back);
    
    scene.appendChild(seat);
  });
}
createSeats();

// Initial instruction text (optional - can be removed)
console.log("%cVR Cinema ready! Load videos and click Enter VR.", "color:#0f0; font-size:16px");
</script>

</body>
</html>