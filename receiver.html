<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sandbox Receiver</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body style="font-family: sans-serif; text-align: center; padding: 20px;">

    <h2>RECEIVER (Phone A)</h2>
    
    <button id="btn" style="padding: 20px; font-size: 20px; background: #0078ff; color: white; border: none; border-radius: 10px; width: 100%; max-width: 400px;">
        1. CLICK TO CONNECT
    </button>
    
    <h3 id="log" style="line-height: 1.5;">Waiting to connect...</h3>
    
    <video id="vid" autoplay playsinline muted style="width: 100%; max-width: 400px; background: black; border: 2px solid #0078ff; min-height: 200px;"></video>
    
    <script>
        const logEl = document.getElementById('log');
        const vid = document.getElementById('vid');
        
        document.getElementById('btn').addEventListener('click', () => {
            logEl.innerText = "1. Connecting to Cloud...";
            logEl.style.color = "blue";
            
            const peer = new Peer({ debug: 2 });
            
            peer.on('open', (id) => {
                logEl.innerText = "2. Cloud OK! Dialing Phone B...";
                
                // THE FIX: Create a fake 1-pixel VIDEO stream so the browser opens a Video Channel
                const canvas = document.createElement('canvas');
                canvas.width = 1; 
                canvas.height = 1;
                const dummyVideoStream = canvas.captureStream(1); // 1 frame per second
                
                // Make the call using the fake video stream
                const call = peer.call('sandbox-cam-99', dummyVideoStream); 
                
                if (!call) return;

                call.peerConnection.oniceconnectionstatechange = () => {
                    const state = call.peerConnection.iceConnectionState;
                    logEl.innerText += "\nNetwork Pipe: " + state.toUpperCase();
                };
                
                // When Phone B answers with the REAL video...
                call.on('stream', remoteStream => {
                    logEl.innerText += "\n3. Stream arrived! Playing...";
                    
                    vid.srcObject = remoteStream;
                    
                    vid.play().then(() => {
                        logEl.innerText += "\nSUCCESS: LIVE FEED ACTIVE!";
                        logEl.style.color = "green";
                    }).catch(e => logEl.innerText += "\nPlay Error: " + e);
                });
            });
        });
    </script>
</body>
</html>
